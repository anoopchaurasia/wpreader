fm.Package("lib"),fm.Class("idbStore123"),lib.idbStore123=function(e){this.setMe=function(t){e=t}},function(e,t,n){typeof define=="function"?define(t):typeof module!="undefined"&&module.exports?module.exports=t():n[e]=t()}("IDBStore",function(){"use strict";var e=function(e){throw e},t={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:e,indexes:[]},n=function(e,n){typeof n=="undefined"&&typeof e=="function"&&(n=e),Object.prototype.toString.call(e)!="[object Object]"&&(e={});for(var r in t)this[r]=typeof e[r]!="undefined"?e[r]:t[r];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,n&&(this.onStoreReady=n);var i=typeof window=="object"?window:self;this.idb=i.indexedDB||i.webkitIndexedDB||i.mozIndexedDB,this.keyRange=i.IDBKeyRange||i.webkitIDBKeyRange||i.mozIDBKeyRange,this.features={hasAutoIncrement:!i.mozIndexedDB},this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()};n.prototype={constructor:n,version:"1.4.0",db:null,dbName:null,dbVersion:null,store:null,storeName:null,keyPath:null,autoIncrement:null,indexes:null,features:null,onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var e=this.idb.open(this.dbName,this.dbVersion),t=!1;e.onerror=function(e){var t=!1;"error"in e.target?t=e.target.error.name=="VersionError":"errorCode"in e.target&&(t=e.target.errorCode==12),t?this.onError(new Error("The version number provided is lower than the existing one.")):this.onError(e)}.bind(this),e.onsuccess=function(e){if(t)return;if(this.db){this.onStoreReady();return}this.db=e.target.result;if(typeof this.db.version=="string"){this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."));return}if(!this.db.objectStoreNames.contains(this.storeName)){this.onError(new Error("Something is wrong with the IndexedDB implementation in this browser. Please upgrade your browser."));return}var n=this.db.transaction([this.storeName],this.consts.READ_ONLY);this.store=n.objectStore(this.storeName),this.indexes.forEach(function(e){var n=e.name;if(!n){t=!0,this.onError(new Error("Cannot create index: No index name given."));return}this.normalizeIndexData(e);if(this.hasIndex(n)){var r=this.store.index(n),i=this.indexComplies(r,e);i||(t=!0,this.onError(new Error('Cannot modify index "'+n+'" for current version. Please bump version number to '+(this.dbVersion+1)+".")))}else t=!0,this.onError(new Error('Cannot create new index "'+n+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))},this),t||this.onStoreReady()}.bind(this),e.onupgradeneeded=function(e){this.db=e.target.result,this.db.objectStoreNames.contains(this.storeName)?this.store=e.target.transaction.objectStore(this.storeName):this.store=this.db.createObjectStore(this.storeName,{keyPath:this.keyPath,autoIncrement:this.autoIncrement}),this.indexes.forEach(function(e){var n=e.name;n||(t=!0,this.onError(new Error("Cannot create index: No index name given."))),this.normalizeIndexData(e);if(this.hasIndex(n)){var r=this.store.index(n),i=this.indexComplies(r,e);i||(this.store.deleteIndex(n),this.store.createIndex(n,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry}))}else this.store.createIndex(n,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})},this)}.bind(this)},deleteDatabase:function(){this.idb.deleteDatabase&&this.idb.deleteDatabase(this.dbName)},put:function(t,n,i,s){this.keyPath!==null&&(s=i,i=n,n=t),s||(s=e),i||(i=r);var o=!1,u=null,a,f=this.db.transaction([this.storeName],this.consts.READ_WRITE);return f.oncomplete=function(){var e=o?i:s;e(u)},f.onabort=s,f.onerror=s,this.keyPath!==null?(this._addIdPropertyIfNeeded(n),a=f.objectStore(this.storeName).put(n)):a=f.objectStore(this.storeName).put(n,t),a.onsuccess=function(e){o=!0,u=e.target.result},a.onerror=s,f},get:function(t,n,i){i||(i=e),n||(n=r);var s=!1,o=null,u=this.db.transaction([this.storeName],this.consts.READ_ONLY);u.oncomplete=function(){var e=s?n:i;e(o)},u.onabort=i,u.onerror=i;var a=u.objectStore(this.storeName).get(t);return a.onsuccess=function(e){s=!0,o=e.target.result},a.onerror=i,u},remove:function(t,n,i){i||(i=e),n||(n=r);var s=!1,o=null,u=this.db.transaction([this.storeName],this.consts.READ_WRITE);u.oncomplete=function(){var e=s?n:i;e(o)},u.onabort=i,u.onerror=i;var a=u.objectStore(this.storeName)["delete"](t);return a.onsuccess=function(e){s=!0,o=e.target.result},a.onerror=i,u},batch:function(t,n,i){i||(i=e),n||(n=r),Object.prototype.toString.call(t)!="[object Array]"&&i(new Error("dataArray argument must be of type Array."));var s=this.db.transaction([this.storeName],this.consts.READ_WRITE);s.oncomplete=function(){var e=a?n:i;e(a)},s.onabort=i,s.onerror=i;var o=t.length,u=!1,a=!1,f=function(){o--,o===0&&!u&&(u=!0,a=!0)};return t.forEach(function(e){var t=e.type,n=e.key,r=e.value,o=function(e){s.abort(),u||(u=!0,i(e,t,n))};if(t=="remove"){var a=s.objectStore(this.storeName)["delete"](n);a.onsuccess=f,a.onerror=o}else if(t=="put"){var l;this.keyPath!==null?(this._addIdPropertyIfNeeded(r),l=s.objectStore(this.storeName).put(r)):l=s.objectStore(this.storeName).put(r,n),l.onsuccess=f,l.onerror=o}},this),s},putBatch:function(e,t,n){var r=e.map(function(e){return{type:"put",value:e}});return this.batch(r,t,n)},removeBatch:function(e,t,n){var r=e.map(function(e){return{type:"remove",key:e}});return this.batch(r,t,n)},getBatch:function(t,n,i,s){i||(i=e),n||(n=r),s||(s="sparse"),Object.prototype.toString.call(t)!="[object Array]"&&i(new Error("keyArray argument must be of type Array."));var o=this.db.transaction([this.storeName],this.consts.READ_ONLY);o.oncomplete=function(){var e=l?n:i;e(c)},o.onabort=i,o.onerror=i;var u=[],a=t.length,f=!1,l=!1,c=null,h=function(e){e.target.result||s=="dense"?u.push(e.target.result):s=="sparse"&&u.length++,a--,a===0&&(f=!0,l=!0,c=u)};return t.forEach(function(e){var t=function(e){f=!0,c=e,i(e),o.abort()},n=o.objectStore(this.storeName).get(e);n.onsuccess=h,n.onerror=t},this),o},getAll:function(t,n){n||(n=e),t||(t=r);var i=this.db.transaction([this.storeName],this.consts.READ_ONLY),s=i.objectStore(this.storeName);return s.getAll?this._getAllNative(i,s,t,n):this._getAllCursor(i,s,t,n),i},_getAllNative:function(e,t,n,r){var i=!1,s=null;e.oncomplete=function(){var e=i?n:r;e(s)},e.onabort=r,e.onerror=r;var o=t.getAll();o.onsuccess=function(e){i=!0,s=e.target.result},o.onerror=r},_getAllCursor:function(e,t,n,r){var i=[],s=!1,o=null;e.oncomplete=function(){var e=s?n:r;e(o)},e.onabort=r,e.onerror=r;var u=t.openCursor();u.onsuccess=function(e){var t=e.target.result;t?(i.push(t.value),t["continue"]()):(s=!0,o=i)},u.onError=r},clear:function(t,n){n||(n=e),t||(t=r);var i=!1,s=null,o=this.db.transaction([this.storeName],this.consts.READ_WRITE);o.oncomplete=function(){var e=i?t:n;e(s)},o.onabort=n,o.onerror=n;var u=o.objectStore(this.storeName).clear();return u.onsuccess=function(e){i=!0,s=e.target.result},u.onerror=n,o},_addIdPropertyIfNeeded:function(e){!this.features.hasAutoIncrement&&typeof e[this.keyPath]=="undefined"&&(e[this.keyPath]=this._insertIdCount++ +Date.now())},getIndexList:function(){return this.store.indexNames},hasIndex:function(e){return this.store.indexNames.contains(e)},normalizeIndexData:function(e){e.keyPath=e.keyPath||e.name,e.unique=!!e.unique,e.multiEntry=!!e.multiEntry},indexComplies:function(e,t){var n=["keyPath","unique","multiEntry"].every(function(n){return n=="multiEntry"&&e[n]===undefined&&t[n]===!1?!0:t[n]==e[n]});return n},iterate:function(t,n){n=s({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:e},n||{});var r=n.order.toLowerCase()=="desc"?"PREV":"NEXT";n.filterDuplicates&&(r+="_NO_DUPLICATE");var i=!1,o=this.db.transaction([this.storeName],this.consts[n.writeAccess?"READ_WRITE":"READ_ONLY"]),u=o.objectStore(this.storeName);n.index&&(u=u.index(n.index)),o.oncomplete=function(){if(!i){n.onError(null);return}n.onEnd?n.onEnd():t(null)},o.onabort=n.onError,o.onerror=n.onError;var a=u.openCursor(n.keyRange,this.consts[r]);return a.onerror=n.onError,a.onsuccess=function(e){var r=e.target.result;r?(t(r.value,r,o),n.autoContinue&&r["continue"]()):i=!0},o},query:function(e,t){var n=[];return t=t||{},t.onEnd=function(){e(n)},this.iterate(function(e){n.push(e)},t)},count:function(t,n){n=s({index:null,keyRange:null},n||{});var r=n.onError||e,i=!1,o=null,u=this.db.transaction([this.storeName],this.consts.READ_ONLY);u.oncomplete=function(){var e=i?t:r;e(o)},u.onabort=r,u.onerror=r;var a=u.objectStore(this.storeName);n.index&&(a=a.index(n.index));var f=a.count(n.keyRange);return f.onsuccess=function(e){i=!0,o=e.target.result},f.onError=r,u},makeKeyRange:function(e){var t,n=typeof e.lower!="undefined",r=typeof e.upper!="undefined",i=typeof e.only!="undefined";switch(!0){case i:t=this.keyRange.only(e.only);break;case n&&r:t=this.keyRange.bound(e.lower,e.upper,e.excludeLower,e.excludeUpper);break;case n:t=this.keyRange.lowerBound(e.lower,e.excludeLower);break;case r:t=this.keyRange.upperBound(e.upper,e.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return t}};var r=function(){},i={},s=function(e,t){var n,r;for(n in t)r=t[n],r!==i[n]&&r!==e[n]&&(e[n]=r);return e};return n.version=n.prototype.version,n},this);
fm.isMinified=true;
